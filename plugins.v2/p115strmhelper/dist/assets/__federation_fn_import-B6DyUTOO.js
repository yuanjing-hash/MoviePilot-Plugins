const e="[0-9A-Za-z-]+",r=`(?:\\+(${e}(?:\\.${e})*))`,$="0|[1-9]\\d*",t="[0-9]+",n="\\d*[a-zA-Z-][a-zA-Z0-9-]*",i=`(?:${t}|${n})`,o=`(?:${$}|${n})`,s=`(?:-(${o}(?:\\.${o})*))`,u=`${$}|x|X|\\*`,a=`[v=\\s]*(${u})(?:\\.(${u})(?:\\.(${u})(?:${s})?${r}?)?)?`,c=`^\\s*(${a})\\s+-\\s+(${a})\\s*$`,f="((?:<|>)?=?)",l=`(\\s*)${f}\\s*(${`[v=\\s]*${`(${t})\\.(${t})\\.(${t})`}${`(?:-?(${i}(?:\\.${i})*))`}?${r}?`}|${a})`,p="(?:~>?)",d=`(\\s*)${p}\\s+`,m="(?:\\^)",v=`(\\s*)${m}\\s+`,h=`^${m}${a}$`,j=`^${p}${a}$`,w=`^${f}\\s*${a}$`,g=`^${f}\\s*(${`v?${`(${$})\\.(${$})\\.(${$})`}${s}?${r}?`})$|^$`;function _(e){return new RegExp(e)}function b(e){return!e||"x"===e.toLowerCase()||"*"===e}function y(...e){return r=>e.reduce((e,r)=>r(e),r)}function R(e){return e.match(_(g))}function O(e,r,$,t){const n=`${e}.${r}.${$}`;return t?`${n}-${t}`:n}function k(e){return e.replace(_(c),(e,r,$,t,n,i,o,s,u,a,c,f)=>`${r=b($)?"":b(t)?`>=${$}.0.0`:b(n)?`>=${$}.${t}.0`:`>=${r}`} ${s=b(u)?"":b(a)?`<${+u+1}.0.0-0`:b(c)?`<${u}.${+a+1}.0-0`:f?`<=${u}.${a}.${c}-${f}`:`<=${s}`}`.trim())}function x(e){return e.replace(_(l),"$1$2$3")}function q(e){return e.replace(_(d),"$1~")}function z(e){return e.replace(_(v),"$1^")}function A(e){return e.trim().split(/\s+/).map(e=>e.replace(_(h),(e,r,$,t,n)=>b(r)?"":b($)?`>=${r}.0.0 <${+r+1}.0.0-0`:b(t)?"0"===r?`>=${r}.${$}.0 <${r}.${+$+1}.0-0`:`>=${r}.${$}.0 <${+r+1}.0.0-0`:n?"0"===r?"0"===$?`>=${r}.${$}.${t}-${n} <${r}.${$}.${+t+1}-0`:`>=${r}.${$}.${t}-${n} <${r}.${+$+1}.0-0`:`>=${r}.${$}.${t}-${n} <${+r+1}.0.0-0`:"0"===r?"0"===$?`>=${r}.${$}.${t} <${r}.${$}.${+t+1}-0`:`>=${r}.${$}.${t} <${r}.${+$+1}.0-0`:`>=${r}.${$}.${t} <${+r+1}.0.0-0`)).join(" ")}function V(e){return e.trim().split(/\s+/).map(e=>e.replace(_(j),(e,r,$,t,n)=>b(r)?"":b($)?`>=${r}.0.0 <${+r+1}.0.0-0`:b(t)?`>=${r}.${$}.0 <${r}.${+$+1}.0-0`:n?`>=${r}.${$}.${t}-${n} <${r}.${+$+1}.0-0`:`>=${r}.${$}.${t} <${r}.${+$+1}.0-0`)).join(" ")}function Z(e){return e.split(/\s+/).map(e=>e.trim().replace(_(w),(e,r,$,t,n,i)=>{const o=b($),s=o||b(t),u=s||b(n);return"="===r&&u&&(r=""),i="",o?">"===r||"<"===r?"<0.0.0-0":"*":r&&u?(s&&(t=0),n=0,">"===r?(r=">=",s?($=+$+1,t=0,n=0):(t=+t+1,n=0)):"<="===r&&(r="<",s?$=+$+1:t=+t+1),"<"===r&&(i="-0"),`${r+$}.${t}.${n}${i}`):s?`>=${$}.0.0${i} <${+$+1}.0.0-0`:u?`>=${$}.${t}.0${i} <${$}.${+t+1}.0-0`:e})).join(" ")}function E(e){return e.trim().replace(_("(<|>)?=?\\s*\\*"),"")}function L(e,r){return(e=+e||e)>(r=+r||r)?1:e===r?0:-1}function S(e,r){return L(e.major,r.major)||L(e.minor,r.minor)||L(e.patch,r.patch)||function(e,r){const{preRelease:$}=e,{preRelease:t}=r;if(void 0===$&&t)return 1;if($&&void 0===t)return-1;if(void 0===$&&void 0===t)return 0;for(let n=0,i=$.length;n<=i;n++){const e=$[n],r=t[n];if(e!==r)return void 0===e&&void 0===r?0:e?r?L(e,r):-1:1}return 0}(e,r)}function T(e,r){return e.version===r.version}function C(e,r){switch(e.operator){case"":case"=":return T(e,r);case">":return S(e,r)<0;case">=":return T(e,r)||S(e,r)<0;case"<":return S(e,r)>0;case"<=":return T(e,r)||S(e,r)>0;case void 0:return!0;default:return!1}}function M(e,r){if(!e)return!1;const $=function(e){return y(k,x,q,z)(e.trim()).split(/\s+/).join(" ")}(r),t=$.split(" ").map(e=>function(e){return y(A,V,Z,E)(e)}(e)).join(" "),n=t.split(/\s+/).map(e=>e.trim().replace(_("^\\s*>=\\s*0.0.0\\s*$"),"")),i=R(e);if(!i)return!1;const[,o,,s,u,a,c]=i,f={version:O(s,u,a,c),major:s,minor:u,patch:a,preRelease:null==c?void 0:c.split(".")};for(const l of n){const e=R(l);if(!e)return!1;const[,r,,$,t,n,i]=e;if(!C({operator:r,version:O($,t,n,i),major:$,minor:t,patch:n,preRelease:null==i?void 0:i.split(".")},f))return!1}return!0}const P={},X=Object.create(null);async function B(e,r="default"){return X[e]?new Promise(r=>r(X[e])):await D(e,r)||F(e)}async function D(e,r){let $=null;if(globalThis?.__federation_shared__?.[r]?.[e]){const t=globalThis.__federation_shared__[r][e],n=P[e]?.requiredVersion;if(!!n){const r=Object.keys(t).find(e=>M(e,n));if(r){const e=t[r];$=await(await e.get())()}else console.log(`provider support ${e}(${r}) is not satisfied requiredVersion(\${moduleMap[name].requiredVersion})`)}else{const e=t[Object.keys(t)[0]];$=await(await e.get())()}}if($)return G($,e)}async function F(e){if(P[e]?.import){return G(await(await P[e].get())(),e)}console.error("consumer config import=false,so cant use callback shared module")}function G(e,r){return"function"==typeof e.default?(Object.keys(e).forEach(r=>{"default"!==r&&(e.default[r]=e[r])}),X[r]=e.default,e.default):(e.default&&(e=Object.assign({},e.default,e)),X[r]=e,e)}export{B as importShared,F as importSharedLocal,D as importSharedRuntime};
